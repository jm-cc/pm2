#!/bin/sh

# PM2: Parallel Multithreaded Machine
# Copyright (C) 2001 "the PM2 team" (see AUTHORS file)
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or (at
# your option) any later version.
# 
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.


if [ "`echo -n`" != "-n" ] ; then
	ECHO='echo -n .'
elif [ -x /usr/bin/printf ] ; then
	ECHO='printf .'
else
	ECHO='echo .'
fi

if [ "${PM2_ROOT}" = "" ]; then
    echo "PM2_ROOT is not defined"
    exit 1
fi

. ${PM2_ROOT}/bin/pm2_vars

make_ln() # Create $3 pointing on $2 in the directory $1
{
    $ECHO
    cd $1
    if [ -z "$3" ]; then
	LINK=`basename $2`
    else
	LINK=$3
    fi
    if [ ! -h "$LINK" ]; then
	ln -s $2 $LINK
    fi
}

echo "Recreating symlink..."
# pm2 links
echo PM2
make_ln ${PM2_ROOT} marcel/ARCHITECTURES ARCHITECTURES
make_ln ${PM2_ROOT}/console graphic/icons icons
make_ln ${PM2_ROOT}/bin pm2textconfig pm2xconfig
make_ln ${PM2_ROOT}/bin pm2textconfig pm2menuconfig

# module links
echo
echo Modules
if [ ! -d ${PM2_ROOT}/modules ] ; then
    mkdir ${PM2_ROOT}/modules
fi
make_ln ${PM2_ROOT}/modules ../appli appli
make_ln ${PM2_ROOT}/modules ../common common
make_ln ${PM2_ROOT}/modules ../dsm dsm
make_ln ${PM2_ROOT}/modules ../generic generic
make_ln ${PM2_ROOT}/modules ../init init
make_ln ${PM2_ROOT}/modules ../leonie leonie
make_ln ${PM2_ROOT}/modules ../leoparse leoparse
#make_ln ${PM2_ROOT}/modules ../mad1 mad1
make_ln ${PM2_ROOT}/modules ../mad2 mad2
make_ln ${PM2_ROOT}/modules ../mad3 mad3
make_ln ${PM2_ROOT}/modules ../marcel marcel
make_ln ${PM2_ROOT}/modules ../ntbx ntbx
make_ln ${PM2_ROOT}/modules ../pm2 pm2
make_ln ${PM2_ROOT}/modules ../profile profile
make_ln ${PM2_ROOT}/modules ../tbx tbx
make_ln ${PM2_ROOT}/modules ../swann swann

# examples links
rm -f ${PM2_ROOT}/mad3/examples/cfgs ${PM2_ROOT}/mad3/examples/networks.cfg
make_ln ${PM2_ROOT}/mad3/examples ${PM2_ROOT}/leonie/examples         cfgs
make_ln ${PM2_ROOT}/mad3/examples ${PM2_ROOT}/leonie/examples/networks.cfg

# architecture-specific directories for the storage of binaries, etc.

# Toolbox

# Mad I
echo
echo Madeleine I
make_ln ${MAD1_ROOT}/ ../marcel/ARCHITECTURES ARCHITECTURES

make_ln ${MAD1_ROOT}/source/ mpi mpi_bip
make_ln ${MAD1_ROOT}/source/ mpi mpi_lam
make_ln ${MAD1_ROOT}/source/ mpi mpi_sgi
make_ln ${MAD1_ROOT}/source/ mpi mpi_sp2

# Mad II
echo
echo Madeleine II
make_ln ${MAD2_ROOT}/ ../marcel/ARCHITECTURES ARCHITECTURES

# DSM
echo
echo DSM
make_ln ${DSM_ROOT}/ ../marcel/ARCHITECTURES ARCHITECTURES

# Fabrication des catégories d'options
echo
echo
echo Creating option sets
${PM2_ROOT}/bin/pm2-make-option-sets

echo
