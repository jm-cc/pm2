#!/bin/sh
##########
#
command=$*

#case $1 in
#    /*) command=$* ;;
#    *) command=`pwd`/$*
#esac

set $command
prog=$1
shift

set `cat $PM2_ROOT/mad2/.mad2_conf`
nb_hosts=$1
shift

rm -f /tmp/$LOGNAME/.mad2_mpl_conf
touch /tmp/$LOGNAME/.mad2_mpl_conf
for h in $*
do
 echo $h >> /tmp/$LOGNAME/.mad2_mpl_conf
 echo copying $prog to $h:/tmp/$LOGNAME ...
 rcp $prog $h:/tmp/$LOGNAME
done
#echo copying $prog to /tmp/$LOGNAME ...
#cp $prog /tmp/$LOGNAME

MP_PROCS=$nb_hosts
MP_EUILIB=us
MP_HOSTFILE=/tmp/$LOGNAME/.mad2_mpl_conf
MP_EUIDEVICE=css0
export MP_PROCS
export MP_EUILIB
export MP_HOSTFILE
export MP_EUIDEVICE

set $command
shift

cd /tmp/mehaut
prog=`basename $prog`

echo "launching poe $prog $*"

poe $prog $*

