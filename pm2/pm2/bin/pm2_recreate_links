#!/bin/sh
#
#                      PM2 HIGH-PERF/ISOMALLOC
#           High Performance Parallel Multithreaded Machine
#                           version 3.0
#
#     Gabriel Antoniu, Olivier Aumage, Luc Bouge, Vincent Danjean,
#       Christian Perez, Jean-Francois Mehaut, Raymond Namyst
#
#            Laboratoire de l'Informatique du Parallelisme
#                        UMR 5668 CNRS-INRIA
#                 Ecole Normale Superieure de Lyon
#
#                      External Contributors:
#                 Yves Denneulin (LMC - Grenoble),
#                 Benoit Planquelle (LIFL - Lille)
#
#                    1998 All Rights Reserved
#
#
#                             NOTICE
#
# Permission to use, copy, modify, and distribute this software and
# its documentation for any purpose and without fee is hereby granted
# provided that the above copyright notice appear in all copies and
# that both the copyright notice and this permission notice appear in
# supporting documentation.
#
# Neither the institutions (Ecole Normale Superieure de Lyon,
# Laboratoire de L'informatique du Parallelisme, Universite des
# Sciences et Technologies de Lille, Laboratoire d'Informatique
# Fondamentale de Lille), nor the Authors make any representations
# about the suitability of this software for any purpose. This
# software is provided ``as is'' without express or implied warranty.
#

if [ "`echo -n`" != "-n" ] ; then
	ECHO='echo -n .'
elif [ -x /usr/bin/printf ] ; then
	ECHO='printf .'
else
	ECHO='echo .'
fi

if [ "${PM2_ROOT}" = "" ]; then
    echo "PM2_ROOT is not defined"
    exit 1
fi

. ${PM2_ROOT}/bin/pm2_vars

make_ln()
{
    $ECHO
    cd $1
    if [ ! -h $3 ]; then
	ln -s $2 $3
    fi
}

# pm2 links
echo PM2
make_ln ${PM2_ROOT} marcel/ARCHITECTURES ARCHITECTURES
make_ln ${PM2_ROOT}/console graphic/icons icons
make_ln ${PM2_ROOT}/toolbox src source
make_ln ${PM2_ROOT}/toolbox/net src source

# module links
echo
echo Modules
make_ln ${PM2_ROOT}/modules ../dsm dsm
make_ln ${PM2_ROOT}/modules ../leonie leonie
make_ln ${PM2_ROOT}/modules ../mad1 mad1
make_ln ${PM2_ROOT}/modules ../mad2 mad2
make_ln ${PM2_ROOT}/modules ../marcel marcel
make_ln ${PM2_ROOT}/modules ../toolbox/net ntbx
make_ln ${PM2_ROOT}/modules ../toolbox tbx
make_ln ${PM2_ROOT}/modules ../swann swann
make_ln ${PM2_ROOT}/modules/pm2 ../../example example
make_ln ${PM2_ROOT}/modules/pm2 ../../include include
make_ln ${PM2_ROOT}/modules/pm2 ../../source source

# architecture-specific directories for the storage of binaries, etc.

# Toolbox

# Marcel
echo
echo Marcel
make_ln ${MARCEL_ROOT}/bin/ ../../bin/pm2_arch pm2_arch
make_ln ${MARCEL_ROOT}/bin/ ../../bin/pm2_sys pm2_sys
make_ln ${MARCEL_ROOT}/include/ ../../include/safe_malloc.h safe_malloc.h
#make_ln ${MARCEL_ROOT}/include/sys/ ../../../include/sys/debug.h debug.h
make_ln ${MARCEL_ROOT}/include/sys/ ../../../include/sys/isomalloc_archdep.h isomalloc_archdep.h
make_ln ${MARCEL_ROOT}/include/ ../../include/timing.h timing.h
make_ln ${MARCEL_ROOT}/source/ ../../source/safe_malloc.c safe_malloc.c
make_ln ${MARCEL_ROOT}/source/ ../../source/timing.c timing.c

# Mad I
echo
echo Madeleine I
make_ln ${MAD1_ROOT}/ ../marcel/ARCHITECTURES ARCHITECTURES
make_ln ${MAD1_ROOT}/bin/ custom/madload madload
make_ln ${MAD1_ROOT}/bin/ ../../bin/pm2_arch pm2_arch
make_ln ${MAD1_ROOT}/bin/ ../../bin/pm2_sys pm2_sys

# Mad I / VIA
if [ -d ${MAD1_ROOT}/bin/via ] ; then
    make_ln ${MAD1_ROOT}/bin/via/ ../tcp/madload madload    
    make_ln ${MAD1_ROOT}/bin/via/ ../tcp/madspawn madspawn
else
    make_ln ${MAD1_ROOT}/bin ./tcp via
fi

# Mad I / SISCI
if [ -d ${MAD1_ROOT}/bin/sisci ] ; then
    make_ln ${MAD1_ROOT}/bin/sisci/ ../tcp/madload madload
    make_ln ${MAD1_ROOT}/bin/sisci/ ../tcp/madspawn madspawn
else
    make_ln ${MAD1_ROOT}/bin ./tcp sisci
fi

# Mad I / SHM
if [ -d ${MAD1_ROOT}/bin/shm ] ; then
    make_ln ${MAD1_ROOT}/bin/shm/ ../tcp/madload madload
    make_ln ${MAD1_ROOT}/bin/shm/ ../tcp/madspawn madspawn
else
    make_ln ${MAD1_ROOT}/bin ./tcp shm
fi

make_ln ${MAD1_ROOT}/include/ ../../include/safe_malloc.h safe_malloc.h
make_ln ${MAD1_ROOT}/include/sys/ ../../../include/sys/debug.h debug.h
make_ln ${MAD1_ROOT}/include/ ../../include/timing.h timing.h
make_ln ${MAD1_ROOT}/source/ mpi mpi-bip
make_ln ${MAD1_ROOT}/source/ mpi mpi-lam
make_ln ${MAD1_ROOT}/source/ mpi mpi-sgi
make_ln ${MAD1_ROOT}/source/ mpi mpi-sp2
make_ln ${MAD1_ROOT}/source/ ../../source/safe_malloc.c safe_malloc.c
make_ln ${MAD1_ROOT}/source/ ../../source/timing.c timing.c
make_ln ${MAD1_ROOT}/source/via/ via2.c netinterf.c


# Mad II
echo
echo Madeleine II
make_ln ${MAD2_ROOT}/ ../marcel/ARCHITECTURES ARCHITECTURES
make_ln ${MAD2_ROOT}/ src source
make_ln ${MAD2_ROOT}/ test examples

# DSM
echo
echo DSM
make_ln ${DSM_ROOT}/include/ ../../include/timing.h timing.h
make_ln ${DSM_ROOT}/include/ ../../include/safe_malloc.h safe_malloc.h
make_ln ${DSM_ROOT}/ ../marcel/ARCHITECTURES ARCHITECTURES

# Madeleine default selection

echo .
# Olivier: changement de 1->2 pour etre coherent avec le parfum `default'
${PM2_ROOT}/bin/pm2madselect 2


