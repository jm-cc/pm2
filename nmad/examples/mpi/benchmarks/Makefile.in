srcdir := @srcdir@
VPATH  := $(srcdir)

include @puk_root@/etc/common_vars.mk

TARGET_BIN_BENCH = mpi_bench_sendrecv mpi_bench_bidir mpi_bench_multi mpi_bench_multi_hetero mpi_bench_sparse_vector mpi_bench_overlap_sender mpi_bench_overlap_recv mpi_bench_overlap_bidir mpi_bench_overlap_sender_noncontig mpi_bench_overlap_send_overhead

TARGET_BIN = $(TARGET_BIN_BENCH) mpi_bench_overlap
TARGET_LIB =
SUBDIRS =

INSTALL_BIN     = $(TARGET_BIN)
INSTALL_LIB     = $(TARGET_LIB)
INSTALL_INCLUDE = 

INSTALL_PREFIX := @nmad_root@

TARGETS = subdirs $(TARGET_BIN) $(TARGET_LIB)

MPICC    ?= @nmad_root@/bin/mpicc
CC       := $(MPICC)
CFLAGS   := @tbx_CFLAGS@
LD       := $(CC)
LDFLAGS  :=
LIBS     := -lm @tbx_LIBS@
CC_DEP   := $(CC) -MM

CLEAN_MORE += $(wildcard stub_*.c)

include @puk_root@/etc/common_rules.mk

#$(TARGET_BIN): %: %.pic.o

TESTS +=
BENCH +=

include @nmad_srcdir@/nmad-tests.mk

stub_%.c:
	@echo "  [GEN]    $@"
	$(Q)echo "extern struct mpi_bench_s mpi_bench_$*; struct mpi_bench_s*mpi_bench_default = &mpi_bench_$*;" > stub_$*.c

$(TARGET_BIN_BENCH): mpi_bench_%: mpi_bench_%.pic.o mpi_bench_generic.pic.o mpi_bench_single.pic.o stub_%.pic.o

mpi_bench_overlap: mpi_bench_overlap.pic.o mpi_bench_generic.pic.o mpi_bench_overlap_sender.pic.o mpi_bench_overlap_recv.pic.o mpi_bench_overlap_bidir.pic.o mpi_bench_overlap_sender_noncontig.pic.o mpi_bench_overlap_send_overhead.pic.o
