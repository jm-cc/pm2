srcdir := @srcdir@
VPATH  := $(srcdir)

include @abs_top_builddir@/common_vars.mk

TARGET_BIN_UNIT = $(patsubst $(srcdir)/%.c, %, $(wildcard $(srcdir)/sr_*.c))

TARGET_BIN_BENCH = nm_bench_sendrecv nm_bench_bidir nm_bench_anygate nm_bench_anytag nm_bench_jumbo nm_bench_dynmem nm_bench_noncontig nm_bench_ssend nm_bench_success nm_bench_manpack nm_bench_flypack nm_bench_flypack_local nm_bench_flypack_copy nm_bench_dataprop nm_bench_flypack_slicer nm_bench_flypack_generator

TARGET_BIN = $(TARGET_BIN_UNIT) $(TARGET_BIN_BENCH)
TARGET_LIB =
SUBDIRS =

INSTALL_BIN     = $(TARGET_BIN)
INSTALL_LIB     = $(TARGET_LIB)
INSTALL_INCLUDE = 

INSTALL_PREFIX := @nmad_root@

TARGETS = subdirs $(TARGET_BIN) $(TARGET_LIB)


CFLAGS  += $(shell env PKG_CONFIG_PATH=@nmad_root@/lib/pkgconfig pkg-config --cflags nmad)
LDFLAGS +=
LIBS    += $(shell env PKG_CONFIG_PATH=@nmad_root@/lib/pkgconfig pkg-config --libs nmad)

include @abs_top_builddir@/common_rules.mk

$(TARGET_BIN_UNIT): sr_%: sr_%.pic.o

$(TARGET_BIN_BENCH): nm_bench_%: nm_bench_%.pic.o nm_bench_generic.pic.o

sr_thread: LIBS += -lpthread

sr_iovec: CFLAGS += -g

BENCH += nm_bench_sendrecv sr_latency

include @nmad_srcdir@/nmad-tests.mk

test-sr_star: NMAD_NODES = 4

test-sr_event: TEST_FILTER = sort -i

