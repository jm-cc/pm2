#!/bin/sh

# PM2: Parallel Multithreaded Machine
# Copyright (C) 2001 "the PM2 team" (see AUTHORS file)
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or (at
# your option) any later version.
# 
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.

if [ "$1" = --force ]; then
    FORCE=yes
else
    FORCE=no
fi

set -- --source-mode
. ${PM2_ROOT}/bin/pm2-flavor-file

if [ $FORCE = yes -o ! -d $PM2_USER_FLAVOR_DIR ]; then
    # No existing flavors yet
    echo "Creating initial sample flavors..."

    COMMON_OPTIONS="--all=opt --common=static"

    PM2_CREATE_FLAVOR=${PM2_CREATE_FLAVOR:-${PM2_ROOT}/bin/pm2-flavor}

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=default \
	--modules="pm2 dsm marcel mad2 tbx ntbx init" $COMMON_OPTIONS \
	--marcel=mono --marcel=smp_shared_queue --marcel=marcel_main \
	--mad2=auto_spawn --mad2=tcp

    for i in mono smp act actsmp; do
	$PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=marcel-$i \
	    --modules="marcel tbx init" $COMMON_OPTIONS \
	    --marcel=$i --marcel=smp_shared_queue --marcel=marcel_main
    done

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=marcel \
	--modules="marcel tbx init" $COMMON_OPTIONS \
	--marcel=mono --marcel=smp_shared_queue --marcel=marcel_main

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=marcel-prof \
	--modules="marcel profile tbx init" $COMMON_OPTIONS \
	--marcel=mono --marcel=smp_shared_queue --marcel=marcel_main \
	--marcel=profile

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=swann \
	--modules="swann tbx ntbx init" $COMMON_OPTIONS

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=leonie \
	--modules="leonie leoparse tbx ntbx init" $COMMON_OPTIONS

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=leoparse \
	--modules="leoparse tbx ntbx init" $COMMON_OPTIONS

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=mad2 \
	--modules="mad2 tbx ntbx init" $COMMON_OPTIONS \
	--mad2=auto_spawn --mad2=tcp

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=mad3 \
	--modules="mad3 marcel tbx ntbx init" $COMMON_OPTIONS \
	--mad3=tcp --marcel=mono --marcel=smp_shared_queue --marcel=marcel_main

    $PM2_CREATE_FLAVOR ${CREATE_FLAGS} set --flavor=pm2 \
	--modules="pm2 dsm marcel mad2 tbx ntbx init" $COMMON_OPTIONS \
	--marcel=mono --marcel=smp_shared_queue --marcel=marcel_main \
	--mad2=auto_spawn --mad2=tcp

else

    # Some flavors are already existing. We just have to make sure
    # that they are still valid
    ${PM2_ROOT}/bin/pm2-clean --refresh --all

fi

exit 0

