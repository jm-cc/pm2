#!/bin/sh

COMMAND=$1
shift

echo "Transmitting request to LAM-MPI"
while [ $# -gt 0 ]; do
    case $1 in
	-b)
	    recon   -d -v ${PM2_CONF_FILE}
	    lamboot -d -v ${PM2_CONF_FILE}
	    exit
	    ;;
	-w)
	    wipe -v ${PM2_CONF_FILE}
	    exit
	    ;;
	-r)
	    shift
	    mpirun N ${COMMAND} "$@"
	    exit
	    ;;
	--)
	    shift
	    break
	    ;;
	*)
	    break
	    ;;
    esac
done

recon   -v ${PM2_CONF_FILE}
lamboot -v ${PM2_CONF_FILE}
mpirun -v N ${COMMAND} "$@"
wipe -d -v ${PM2_CONF_FILE}

##########
