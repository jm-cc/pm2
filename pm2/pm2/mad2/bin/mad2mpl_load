#!/bin/sh

# PM2: Parallel Multithreaded Machine
# Copyright (C) 2001 "the PM2 team" (pm2-dev@listes.ens-lyon.fr)
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or (at
# your option) any later version.
# 
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.


command=$*

#case $1 in
#    /*) command=$* ;;
#    *) command=`pwd`/$*
#esac

set $command
prog=$1
shift

set `cat $PM2_CONF_FILE`
nb_hosts=$1
shift

for h in $*
do
 rcp $prog $h:/tmp/$LOGNAME
done

MP_PROCS=$nb_hosts
MP_EUILIB=us
MP_HOSTFILE=$PM2_CONF_FILE
MP_EUIDEVICE=css0
export MP_PROCS
export MP_EUILIB
export MP_HOSTFILE
export MP_EUIDEVICE

set $command
shift

cd /tmp/$LOGNAME
prog=`basename $prog`
poe $prog $*

