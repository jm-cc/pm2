# autoconf-based makefile for pioman

srcdir := @srcdir@
VPATH  := $(srcdir)/source

include @abs_top_builddir@/common_vars.mk

TARGET_BIN = 
TARGET_LIB = libpioman.so
TARGETS    = $(TARGET_BIN) $(TARGET_LIB)

INSTALL_BIN       = $(TARGET_BIN)
INSTALL_LIB       = $(TARGET_LIB)
INSTALL_INCLUDE  += $(wildcard $(srcdir)/include/*.h)
INSTALL_PKGCONFIG = pioman.pc
INSTALL_INCLUDE_PATH := $(INSTALL_PREFIX)/include

CPPFLAGS += -I@srcdir@/include
CFLAGS   += @PIOMAN_CFLAGS@ @PIOMAN_EXT_CFLAGS@
LIBS     += @PIOMAN_EXT_LIBS@

SRC_FILES := $(wildcard $(srcdir)/source/*.c )
OBJ_FILES := $(patsubst $(srcdir)/source/%.c, ./%.pic.o, $(SRC_FILES))

include @abs_top_builddir@/common_rules.mk

libpioman.so: $(OBJ_FILES)

docs: doxygen

doxygen: $(SRC_FILES)

eztrace: eztrace-gen | eztrace-build

eztrace-gen:
	$(Q)eztrace_create_plugin -o eztrace_pioman -I $(srcdir)/include -I @abs_top_builddir@/include ./eztrace-pioman.tpl

eztrace-build:
	$(Q)$(MAKE) -C eztrace_pioman CC=$(CC) CFLAGS="$(CFLAGS)"

