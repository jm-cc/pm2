
#-*-sh-*-
# PM2: Parallel Multithreaded Machine
# Copyright (C) 2001 "the PM2 team" (see AUTHORS file)
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or (at
# your option) any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.

script="<undefined>"

create_test_flavor() {
    # Creation de la flavor
    modules=""
    options=""
    if [ "${ext}" == "pioman" ] ; then
	modules="marcel pioman"
	options="--puk=enable_pukabi --marcel=\"numa smp_remote_tasklet enable_stats standard_main\" --init=\"topology\""
    fi
    tag="tag_as_flat_array"
    if [ "$mpi" == "mpi_emu" ] ; then
	tag="tag_as_hashtable"
    fi
    eval ${PM2_OBJROOT}/bin/pm2-flavor set --flavor=\"$flavor\" \
	--modules=\"puk nmad tbx ntbx init $modules\" \
	--nmad=\"${net} strat_custom ${mpi} mad3_emu $tag\" \
	$options \
	--common=\"fortran_target_none\" \
	--all=\"build_dynamic debug gdb\"
}

prerun_test() {
    nmad-driver-conf -f --${net}
    nmad-strategy-conf -f --strategy=${strat}
    # should compare all the lines of the output and not only the number
    # of lines present in the expected output file
    check_all_lines=1
}
