#!/bin/sh

nb_hosts=`cat ${PM2_CONF_FILE} | wc -w`

tmpfile=/tmp/$user-lamhosts
while [ -f $tmpfile ]; do
    tmpfile="${tmpfile}-bis"
done

cat ${PM2_CONF_FILE} | sort | uniq > $tmpfile

lamboot $tmpfile

prog=$1
shift

mpirun -f -w -nger -c2c -c $nb_hosts -x DISPLAY,PM2_CONF_FILE $prog -- "$@"

lamwipe $tmpfile
rm -f $tmpfile

