#!/bin/sh
#-*-sh-*-

# PM2: Parallel Multithreaded Machine
# Copyright (C) 2001 "the PM2 team" (see AUTHORS file)
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or (at
# your option) any later version.
# 
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.

if [ -z "$PM2_ARCH" -o -z "$PM2_ASM" ]; then
        if [ -n "$PM2_HT" ] ; then
	    _hosttype="$PM2_HT"
	else
	    _hosttype="`uname -sm`"
	fi

	case "$_hosttype" in
	"SunOS sun"*)        PM2_ARCH=SPARC_ARCH ; PM2_ASM=sparc ;;
	*" sparc"*)          PM2_ARCH=SPARC_ARCH ; PM2_ASM=sparc ;;
	*" i86pc")           PM2_ARCH=X86_ARCH ; PM2_ASM=i386 ;;
	*i[3456]86*)         PM2_ARCH=X86_ARCH ; PM2_ASM=i386 ;;
	*" x86_64")          PM2_ARCH=X86_64_ARCH ; PM2_ASM=x86_64 ;;
	"BSD/OS "i[3456]86)  PM2_ARCH=X86_ARCH ; PM2_ASM=i386 ;;
	"FreeBSD i386")      PM2_ARCH=X86_ARCH ; PM2_ASM=i386 ;;
	*" ia64")            PM2_ARCH=IA64_ARCH ; PM2_ASM=ia64 ;;
	"AIX"*" "*)          CPU=`lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
			   if lsattr -El $CPU | grep -q ' POWER' ;
			   then
			     PM2_ARCH=RS6K_ARCH ; PM2_ASM=rs8k ;
			   else
			     PM2_ARCH=PPC_ARCH ; PM2_ASM=ppc ;
			   fi
			   ;;
	*" alpha")           PM2_ARCH=ALPHA_ARCH ; PM2_ASM=alpha ;;
	*" mips")            PM2_ARCH=MIPS_ARCH ; PM2_ASM=mips ;;
	*" IP"*)             PM2_ARCH=MIPS_ARCH ; PM2_ASM=mips ;;
	*" ppc")  	     PM2_ARCH=PPC_ARCH ; PM2_ASM=ppc ;;
	"Linux ppc64")  	   PM2_ARCH=PPC_ARCH ; PM2_ASM=ppc ;;
	*" ppc64")  	     PM2_ARCH=PPC64_ARCH ; PM2_ASM=ppc64 ;;
        *" Power"*)          PM2_ARCH=PPC_ARCH ; PM2_ASM=ppc ;;
        *)                   echo "unknown arch \`$_hosttype', please set in bin/pm2-arch";
	                     PM2_ARCH=UNKNOWN_ARCH ; PM2_ASM=unknown ;;
	esac
fi

case "$1" in
    --source-mode)
	# do nothing
	;;
    --pm2-arch)
	echo $PM2_ARCH
	exit 0
	;;
    --pm2-asm)
	echo $PM2_ASM
	exit 0
	;;
    "")
	echo $PM2_ARCH
	exit 0
	;;
    *)
	exit 1
	;;
esac

