#!/bin/sh
###########
#
# Wrapper for pm2_xload

echo "##### `hostname`"
prog=$1
shift

if [ -n "${LEO_LD_PRELOAD}" ]; then
    env "LD_PRELOAD=${LEO_LD_PRELOAD}" $prog ${@:+"$@"}
else
    if [ -n "${LEO_ALLOW_CORE}" ] ; then
	ulimit -c unlimited
    fi
#    echo $prog ${@:+"$@"}
    echo ${@:+"$@"} | tr ' ' '\012' > /tmp/`hostname`
    $prog ${@:+"$@"}
fi

code=$?

if [ "${PM2_PMODE}" = on ]
then
    echo "process terminated with code ${code}"
    sleep 2
    read dummy
else
    [ $code -gt 0 ] && echo "process terminated with code ${code}"

fi
