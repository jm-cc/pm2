#!/bin/sh

#
# madspawn attend les paramètres suivants :
# $1 : machine serveur
# $2 : confsize
# $3 : node id du maitre...
# $4 à ... : executable a lancer et arguments
#

serverhost=$1
shift
confsize=$1
shift
master=$1
shift

command=$*

mynumber=1
nbmachines=`cat ${HOME}/.madconf | wc -w`

if test -z "$MAD_DEBUG"
then
    MAD_DEBUG=off
fi

if test -z "$DISPLAY"
then
    DISPLAY=:0
fi

if test -z "`/sbin/lsmod | grep Base`"
then
    echo "Enter root password to install SCI module:"
    su -c /sbin/insmod /sci/Base.o
fi

while test $mynumber -lt $confsize
do
    plusun=`expr $mynumber % $nbmachines + 1`
    host=`head -$plusun ${HOME}/.madconf | tail -1`
echo "BEWARE ! $host will receive \"madstart $DISPLAY $MAD_DEBUG $confsize $mynumber $host $master $command &\""
    rsh -n $host ${MADELEINE_ROOT}/bin/sci/madstart $DISPLAY $MAD_DEBUG $confsize $mynumber $host $master $command &
    mynumber=`expr $mynumber + 1`
    shift
done



